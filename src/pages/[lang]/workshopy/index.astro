---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { frontKonData } from '@/data/frontkon-data';
import type { Locale } from '@/data/types';
import { getText } from '@/utils/content';
import { getTranslation, getTranslationObject } from '@/utils/i18n';
import { languages, defaultLanguage } from '@/i18n/config';

export function getStaticPaths() {
  return languages.map((lang) => ({
    params: { lang },
  }));
}

const { lang: langParam } = Astro.params;
const lang: Locale = (langParam && languages.includes(langParam as Locale)) 
  ? (langParam as Locale) 
  : defaultLanguage;

const workshops2026 = frontKonData.workshops.filter((w) => w.yearId === '2026').slice(0, 6);
const topRowWorkshops = workshops2026.slice(0, 3);
const bottomRowWorkshops = workshops2026.slice(3, 6);
const base = import.meta.env.BASE_URL || '/';
const pref = (path: string) => `${base.replace(/\/$/, '')}${path}`;
const t = getTranslationObject(lang, 'workshops');
const tickets = getTranslationObject(lang, 'homepage', 'tickets');
---

<BaseLayout title={t.title} lang={lang}>
  <!-- Hero sekce s placeholderem -->
  <section class="section" style="padding-top: 0;">
    <div style="width: 100%; background: rgba(0, 0, 34, 0.05); border: 1px solid rgba(0, 0, 34, 0.2); padding: 4rem 2rem; text-align: center; margin-bottom: 3rem;">
      <h1 style="font-size: 48px; font-weight: 600; color: rgb(0, 0, 34); margin-bottom: 1rem; font-family: 'League Spartan', sans-serif;">{t.heroTitle}</h1>
      <div style="background: rgba(0, 0, 34, 0.1); border: 1px dashed rgba(0, 0, 34, 0.3); padding: 3rem; color: rgba(0, 0, 34, 0.6); margin-top: 2rem;">
        <p>{t.heroPlaceholder}</p>
      </div>
    </div>
  </section>

  <!-- Sekce "Proč workshopy?" s 3 boxíky -->
  <section class="section">
    <div class="section-header">
      <h2>{t.whyTitle}</h2>
    </div>
    <div class="grid features-grid">
      {(t.whyItems || []).map((item: any) => (
        <div class="card">
          <h3>{item.title}</h3>
          <p class="modal-description">{item.desc}</p>
        </div>
      ))}
    </div>
  </section>

  <section class="section">
    <div class="section-header">
      <h2>{t.listTitle}</h2>
      <p class="subtitle">{t.listDescription}</p>
    </div>
    <div class="grid workshops-grid">
      {topRowWorkshops.map((ws) => {
        const speaker = frontKonData.speakers.find((s) => s.id === ws.speakerId);
        return (
          <div class="card">
            <h3>{getText(ws.title, lang)}</h3>
            {speaker && (
              <div style="display: flex; align-items: center; gap: 0.75rem; margin-top: 0.75rem; margin-bottom: 0.5rem;">
                <div style="width: 40px; height: 40px; border-radius: 50%; border: 1px solid rgba(0, 0, 34, 0.2); overflow: hidden; background: rgba(0, 0, 34, 0.1); flex-shrink: 0;">
                  <div style="width: 100%; height: 100%;"></div>
                </div>
                <div>
                  <p style="margin: 0; font-size: 14px; font-weight: 500; color: rgb(0, 0, 34);">{speaker.name}</p>
                  <p style="margin: 0; font-size: 12px; color: rgba(0, 0, 34, 0.6);">{speaker.company}</p>
                </div>
              </div>
            )}
            <p class="modal-description">{getText(ws.description, lang)}</p>
            <p class="list-meta">{ws.duration} {t.min} · {t.capacityLabel} {ws.capacity} · {ws.price}</p>
            <div style="margin-top: 1rem;">
              <a class="btn-secondary" href={pref(`/${lang}/workshopy/${ws.id}/`)}>{lang === 'cs' ? 'Detail workshopu' : 'Workshop details'}</a>
            </div>
          </div>
        );
      })}
    </div>
    <div class="grid workshops-grid" style="margin-top: 1.5rem;">
      {bottomRowWorkshops.map((ws) => {
        const speaker = frontKonData.speakers.find((s) => s.id === ws.speakerId);
        return (
          <div class="card">
            <h3>{getText(ws.title, lang)}</h3>
            {speaker && (
              <div style="display: flex; align-items: center; gap: 0.75rem; margin-top: 0.75rem; margin-bottom: 0.5rem;">
                <div style="width: 40px; height: 40px; border-radius: 50%; border: 1px solid rgba(0, 0, 34, 0.2); overflow: hidden; background: rgba(0, 0, 34, 0.1); flex-shrink: 0;">
                  <div style="width: 100%; height: 100%;"></div>
                </div>
                <div>
                  <p style="margin: 0; font-size: 14px; font-weight: 500; color: rgb(0, 0, 34);">{speaker.name}</p>
                  <p style="margin: 0; font-size: 12px; color: rgba(0, 0, 34, 0.6);">{speaker.company}</p>
                </div>
              </div>
            )}
            <p class="modal-description">{getText(ws.description, lang)}</p>
            <p class="list-meta">{ws.duration} {t.min} · {t.capacityLabel} {ws.capacity} · {ws.price}</p>
            <div style="margin-top: 1rem;">
              <a class="btn-secondary" href={pref(`/${lang}/workshopy/${ws.id}/`)}>{lang === 'cs' ? 'Detail workshopu' : 'Workshop details'}</a>
            </div>
          </div>
        );
      })}
    </div>
  </section>

  <section class="section">
    <div class="section-header">
      <h2>{t.faqTitle}</h2>
    </div>
    <div class="accordion" style="max-width: 800px; margin: 0 auto;">
      {(t.faq || []).map((item: any) => (
        <details class="accordion-item">
          <summary>{item.q}</summary>
          <p>{item.a}</p>
        </details>
      ))}
    </div>
  </section>
</BaseLayout>
